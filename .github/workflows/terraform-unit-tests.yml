name: Terraform Unit Tests

on:
  push:
  # Todo: Add a nightly run

jobs:
  terraform-unit-tests:
    name: ${{ matrix.module }}-unit-tests
    runs-on: ubuntu-latest
    strategy:
      matrix:
        module:
          - application-load-balancer
          - cdn
          - data-migration
          - domain
          - elasticache-redis
          - environment-pipelines
          - extensions
          - logs
          - monitoring
          - opensearch
          - postgres
          - s3
          - statefile-backend
          - vpc
          - vpc-peering
      fail-fast: false

    steps:
      - uses: actions/checkout@v4
      - uses: hashicorp/setup-terraform@v3
      - run: |
          cd ${{ matrix.module }}
          terraform init
      - run: |
          cd ${{ matrix.module }}
          terraform test
